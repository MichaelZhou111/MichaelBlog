---
layout: post
title: Nginx 负载均衡和反向代理设置
date:  2019-08-09
tags: nginx 技术
categories: 工具 nginx
description: Nginx 负载均衡和反向代理设置
keywords: nginx

---

#  什么是负载均衡？
# 什么是反向代理？
# nginx 安装
## 通过yum 源安装
### 配置yum源
1、首先修改公司的yum源配置， cd /etc/yum.repos.d/  ，修改CentOS-7.6-Base.repo 。
2、除此之外，在安装epel 源。（extra package for enterprise linux， 为“红帽系”的操作系统提供额外的软件包，适用于RHEL、CentOS等，
里面有1万多个软件，强烈建议安装） yum install epel-release
如果epel无法安装，请参见：[yum安装epel源](https://www.cnblogs.com/f66666/p/9834835.html)
### 通过源码安装
1. 安装前工作首先更新系统软件源，使用以下命令更新系统 -
[root@localhost ~]# yum update
> 有关两个命令的一点解释：
yum -y update - 升级所有包，改变软件设置和系统设置,系统版本内核都升级
yum -y upgrade - 升级所有包，不改变软件设置和系统设置，系统版本升级，内核不改变

依赖包安装
[root@localhost src]# yum -y install gcc gcc-c++ autoconf automake libtool make cmake
[root@localhost src]# yum -y install zlib zlib-devel openssl openssl-devel pcre-devel

2.  下载Nginx安装源文件
http://nginx.org/en/download.html   nginx-1.10.2.tar.gz

3. 新建nginx用户及用户组
用 root 用户身份登录系统，执行以下命令创建新的用户。
[root@localhost src]# groupadd nginx
[root@localhost src]# useradd -g nginx -M nginx
>useradd命令的-M参数用于不为nginx建立home目录修改/etc/passwd，
使得nginx用户无法bash登陆(nginx用户后面由/bin/bash改为/sbin/nologin)

[root@localhost src]# vi /etc/passwd
然后找到有 nginx 那一行，把它修改为(后面由/bin/bash改为/sbin/nologin)：
nginx:x:1002:1003::/home/nginx:/sbin/nologin

4. 配置、编译、安装
下面我们进入解压的nginx源码目录：/usr/local/src/ 执行以下命令 -
[root@localhost ~]# cd /usr/local/src/nginx*
[root@localhost nginx-1.10.3]# pwd
/usr/local/src/nginx-1.10.3
[root@localhost nginx-1.10.3]#
[root@localhost nginx-1.10.3]# ./configure --prefix=/usr/local/nginx \
--pid-path=/usr/local/nginx/run/nginx.pid \
--with-http_ssl_module \
--user=nginx \
 --group=nginx \
--with-pcre \
--without-mail_pop3_module \
--without-mail_imap_module \
--without-mail_smtp_module

> 注意：上面的反斜杠\ 表示换行继续。

--prefix=/usr/local/nginx 指定安装到 /usr/local/nginx 目录下。
上面配置完成后，接下来执行编译 -原文出自【易百教程】，商业转载请联系作者获得授权，非商业请保留原文链接：https://www.yiibai.com/nginx/nginx-install.html

[root@localhost nginx-1.10.3]# make
[root@localhost nginx-1.10.3]# make install

查看安装后的程序版本：
[root@localhost nginx-1.10.3]# /usr/local/nginx/sbin/nginx -v
nginx version: nginx/1.10.3

5. 启动、停止
nginx 管理的几种方式 -
5.1  启动Nginx 
/usr/local/nginx/sbin/nginx 
5.2 从容停止Nginx：
kill -QUIT 主进程号 # 如上一步中的 ps 命令输出的 29151，就是 Nginx的主进程号
5.3 快速停止Nginx：
kill -TERM 主进程号
5.4 强制停止Nginx：
pkill -9 nginx
5.5 平滑重启nginx
/usr/nginx/sbin/nginx -s reload

参照：[Nginx安装](https://www.yiibai.com/nginx/nginx-install.html)


## 通过yum安装
1. 添加Nginx仓库
vim /etc/yum.repos.d/nginx.repo
输入下面内容
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/centos/7/$basearch/
gpgcheck=0
enabled=1

2. 安装：
yum install nginx

3. 启动Nginx
systemctl start nginx
或者 进入/usr/sbin，执行
./nginx
或者执行
service nginx start

4. 测试页面
http://127.0.0.1/ 如果页面没有出来，查看防火墙配置
vi /etc/sysconfig/iptables   添加下面内容
-A INPUT -m state –state NEW -m tcp -p tcp –dport 80 -j ACCEPT（允许80端口通过防火墙） 
-A INPUT -m state –state NEW -m tcp -p tcp –dport 3306 -j ACCEPT（mysql端口  允许3306端口通过防火墙）
然后重启防火墙：service iptables restart

5. 把Nginx加到系统启动项，这样每次开机的时候就自动启动了，使用下面的命令:
systemctl enable nginx

参照：[Linux(Centos7)yum安装Nginx](https://blog.csdn.net/gebitan505/article/details/54601336)

# nginx 配置解析


https://www.cnblogs.com/Miss-mickey/p/6734831.html
https://www.cnblogs.com/qlqwjy/p/8536779.html





 